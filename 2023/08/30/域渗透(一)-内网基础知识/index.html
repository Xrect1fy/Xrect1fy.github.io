<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>域渗透(一)-内网基础知识 | Xrect1fy's blog</title><meta name="author" content="Xrect1fy"><meta name="copyright" content="Xrect1fy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="域渗透基础知识,域环境搭建">
<meta property="og:type" content="article">
<meta property="og:title" content="域渗透(一)-内网基础知识">
<meta property="og:url" content="http://xrect1fy.github.io/2023/08/30/%E5%9F%9F%E6%B8%97%E9%80%8F(%E4%B8%80)-%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/index.html">
<meta property="og:site_name" content="Xrect1fy&#39;s blog">
<meta property="og:description" content="域渗透基础知识,域环境搭建">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302059595.png">
<meta property="article:published_time" content="2023-08-30T12:54:08.000Z">
<meta property="article:modified_time" content="2023-08-31T10:54:34.090Z">
<meta property="article:author" content="Xrect1fy">
<meta property="article:tag" content="内网渗透">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302059595.png"><link rel="shortcut icon" href="/img/tx.jpg"><link rel="canonical" href="http://xrect1fy.github.io/2023/08/30/%E5%9F%9F%E6%B8%97%E9%80%8F(%E4%B8%80)-%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '域渗透(一)-内网基础知识',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-31 18:54:34'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/tx.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> Friends</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Xrect1fy's blog"><img class="site-icon" src="/./img/tx.jpg"/><span class="site-name">Xrect1fy's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> Friends</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">域渗透(一)-内网基础知识</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-30T12:54:08.000Z" title="发表于 2023-08-30 20:54:08">2023-08-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-31T10:54:34.090Z" title="更新于 2023-08-31 18:54:34">2023-08-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E5%AE%89/">网安</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>15分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="域渗透(一)-内网基础知识"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="内网基础知识"><a href="#内网基础知识" class="headerlink" title="内网基础知识"></a>内网基础知识</h1><h2 id="1-活动目录-AD"><a href="#1-活动目录-AD" class="headerlink" title="1.活动目录(AD)"></a>1.活动目录(AD)</h2><h3 id="1-1Ntds-dit文件"><a href="#1-1Ntds-dit文件" class="headerlink" title="1.1Ntds.dit文件"></a>1.1Ntds.dit文件</h3><ol>
<li>活动目录是安装在域控上，存储了域各种信息的组件。</li>
<li>目录数据存储在NTds.dit文件中，Ntds.dit文件时域控的一个二进制文件，其位置为”%SystemRoot%\ntds\ntds.dit”。</li>
<li>Ntds.dit文件中存储有关域用户、用户密码的哈希散列值、用户组、组成员身份和组策略信息等。</li>
<li>Ntds.dit文件使用存储在SYSTEM文件的密钥对这些哈希值进行加密</li>
<li>在非域环境中，用户的登陆凭据存储在SAM文件中</li>
</ol>
<h3 id="1-2目录服务与LDAP"><a href="#1-2目录服务与LDAP" class="headerlink" title="1.2目录服务与LDAP"></a>1.2目录服务与LDAP</h3><p>1.活动目录是一种目录服务数据库，利用LDAP服务名称路径来描述对象在活动目录中的位置。<br>2.DN:绝对可辨识名称，指向一个LDAP对象的完整路径<br>3.RDN：用于指向一个LDAP对象的相对路径<br>4.活动目录的访问:可以里利用微软官方的AD Explorer工具连接域控制器来访问<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/sysinternals/downloads/adexplorer">下载链接</a><br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302118006.png"><br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302120579.png"><br>5.活动目录分区:域分区、配置分区、架构分区</p>
<h3 id="1-3活动目录的查询"><a href="#1-3活动目录的查询" class="headerlink" title="1.3活动目录的查询"></a>1.3活动目录的查询</h3><p>1.LDAP按位查询<br>按位查询语法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;属性名称&gt;:&lt;BitFilterRule-ID&gt;:=&lt;十进制的位值&gt;</span><br><span class="line">BitFilterRule-ID:查询规则对应的ID</span><br><span class="line">十进制的位值:对应查询属性的位的十进制值的和</span><br></pre></td></tr></table></figure>
<p>位查询规则<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302133055.png"><br>部分属性信息<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302134402.png"><br>例如:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(userAccountControl:1.2.840.113556.1.4.803:=131080)</span><br><span class="line">查询属性为userAccountControl</span><br><span class="line">1.2.840.113556.1.4.803 位查询规则为AND</span><br><span class="line">131080代表查询的是HOMEDIR_REQUIRED(8)和MNS_LOGON_ACCOUN(131072)两个位</span><br></pre></td></tr></table></figure>

<p>2.ADFind查询活动目录<br><a target="_blank" rel="noopener" href="https://www.softpedia.com/get/Programming/Other-Programming-Files/AdFind.shtml#download">下载链接</a><br>Adfind可以在域内任何一台主机上用,查询语法为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Adfind.exe [switches] [-b basedn] [-f filter] [attr list]</span><br><span class="line">-b 指定一个BaseDN作为查询的根</span><br><span class="line">-f 为LDAP过滤条件</span><br><span class="line">attr list 为需要显示的属性</span><br></pre></td></tr></table></figure>

<p>例如</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Adfind.exe -b dc=hack-my,dc=com -f &quot;objectClass=computer&quot; name operatingSystem</span><br><span class="line">-b 指定查询hack-my.com域</span><br><span class="line">-f 指定查询所有computer对象</span><br><span class="line">name operatingSystem 并且过滤对象的name 和operatingSystem属性</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302146854.png"></p>
<p>常用查询<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302148133.png"><br>Adfind也支持按位查询</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Adfind.exe -b dc=hack-my, dc=com -f &quot;(userAccountControl:AND:=131080)&quot; -bit -dn</span><br></pre></td></tr></table></figure>

<h2 id="2-域用户与机器用户介绍"><a href="#2-域用户与机器用户介绍" class="headerlink" title="2.域用户与机器用户介绍"></a>2.域用户与机器用户介绍</h2><h3 id="2-1域用户"><a href="#2-1域用户" class="headerlink" title="2.1域用户"></a>2.1域用户</h3><p>1.域用户是域环境中的用户，在域控中被创建，所有信息保存在活动目录中<br>2.域用户位于全局组Domain Users<br>计算机本地用户位于本地User组中，计算机加入域时，全局组Domain Users会被添加到计算机本地User组中<br>3.在任一计算机中执行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">net user /domain</span><br></pre></td></tr></table></figure>
<p>可以查看域中所有用户<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302150542.png"></p>
<h3 id="2-2机器用户"><a href="#2-2机器用户" class="headerlink" title="2.2机器用户"></a>2.2机器用户</h3><p>1.机器用户拥有域用户的属性<br>2.域环境中，计算机本地用户SYSTEM对应域中的机器账户，在域中的用户名是 “机器名+$”<br>3.查看域中所有的机器用户</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">net group &quot;Domain Computers&quot; /domain</span><br></pre></td></tr></table></figure>
<p>4.在获取域中主机时可能权限受限，提升到SYSTEM权限可执行更多命令。<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302153209.png"></p>
<h2 id="3-域用户组的分类和权限"><a href="#3-域用户组的分类和权限" class="headerlink" title="3.域用户组的分类和权限"></a>3.域用户组的分类和权限</h2><p>组分为通讯组和安全组，通讯组:通讯发消息，安全组:用户权限的集合</p>
<h3 id="安全组的权限"><a href="#安全组的权限" class="headerlink" title="安全组的权限"></a>安全组的权限</h3><h4 id="1-域本地组"><a href="#1-域本地组" class="headerlink" title="1.域本地组"></a>1.域本地组</h4><p>1.域本地主要用于访问同一个域中的资源。<br>2.除了本组的用户，域本地组还可以包含域林内的任何一个域和通用组、全局组的用户<br>3.域本地组只能够访问本域中的资源，无法访问其他不同域中的资源<br>4.查询所有域本地组</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Adfind.exe -b &quot;dc=hack-my, dc=com&quot; -bit -f &quot;(&amp;(objectClass=group)(grouptype:AND:=4))&quot; cn -dn</span><br></pre></td></tr></table></figure>
<p>域本地组在活动目录中都是Group类的实例,而域组的作用类型是由其groupType属性决定的,该属性是一个位属性<br>5.常见的系统内置的域本地组有:Administrators管理员组,Print Operators:打印机操作组,Backup Operators:备份操作组,Remote  Desktop Users:远程登录组,Account Operators 账号操作组,Server Operators:服务器操作员组</p>
<h4 id="2-通用组"><a href="#2-通用组" class="headerlink" title="2.通用组"></a>2.通用组</h4><p>1.通用组可以作用于域林的所有与,其成员可以包括域林中任何域的用户账户、全局组和其他通用组，但是无法包含任何一个域中的域本地组<br>2.通用组可以在域林的任何域中被指派访问权限，以便访问所有域中的资源。域管理员进行域管理时，可以为通用组授予对域林中所有域的资源访问权限，而不想需要考虑此通用组所在的位置<br>3.查询寻所有的通用组</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Adfind.exe -b dc=hack-my,dc=com -bit -f &quot;(&amp;(objectClass=group)(grouptype:AND:=8))&quot; cn -dn</span><br></pre></td></tr></table></figure>
<p>4.常见的系统内置通用组<br>Enterprise Admins:组织系统管理员组,该组中的成员在域林每个域中都是Administrators组的权限<br>Schema Admins:架构管理员组,该组中的成员可以修改活动目录,如在架构分区中新增类或属性</p>
<h4 id="3-全局组"><a href="#3-全局组" class="headerlink" title="3.全局组"></a>3.全局组</h4><p>1.全局组可以作用于域林的所有域,是介于域本地组和通用组的组<br>2.全局组只能包含本域的用户<br>3.全局组可以嵌套在同一个域的另一个全局组中,也可以嵌套在其他域的通用组或本地组中<br>4.全局组可以在域林的任何域中被指派访问权限<br>5.查询所有的全局组</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Adfind.exe -b &quot;dc=hack-my,dc=com&quot; -bit -f &quot;(&amp;(objectClass=group)(grouptype:AND:=2))&quot; cn -dn</span><br></pre></td></tr></table></figure>

<p>6.常见的系统内置的全局组:<br>Domain Admins:域管理员组<br>Domain Users:域用户组<br>Domain Computers:域成员主机组</p>
<h2 id="4-组织单位"><a href="#4-组织单位" class="headerlink" title="4.组织单位"></a>4.组织单位</h2><p>1.组织单位是一个可以将域中的用户、组、计算机等对象放入其中的容器对象，是可以指派组策略或委派管理权限的最小作用域或单元。<br>2.组织单位可以统一管理组织单位中的域对象，包括且不限于：用户、计算机、工作组、打印机、安全策略等<br>3.在组织域环境中经常可以看到按照部门划分的一个个组织单位<br>4.所有组织单位在活动目录中都是organizationUnit类的实例,可以通过</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(objectClass=organizationalUnit)</span><br><span class="line">(objectCategory=organizationalUnit)</span><br></pre></td></tr></table></figure>

<p>来查询所有的OU</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Adfind.exe -b &quot;dc=hack-my,dc=com&quot; -f &quot;(objectClass=organizationalUnit)&quot; -dn</span><br></pre></td></tr></table></figure>

<p>将BaseDN设定为指定的组织单元，便可以查询其中指定的对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Adfind.exe -b &quot;OU=科研中心, DC=hack-my, DC=com&quot; -dn</span><br></pre></td></tr></table></figure>

<h2 id="5-访问控制"><a href="#5-访问控制" class="headerlink" title="5.访问控制"></a>5.访问控制</h2><p>1.访问控制是Windows操作系统使用内置授权和访问控制技术，确定经过身份验证的用户是否具有访问资源的正确权限，以控制主体操作对象的行为是否具有合法权限</p>
<p>2.Windows中，访问主题通常指安全主体。安全主体是任何可通过操作系统进行身份验证的实体，如用户账户，计算机账户等。被访问的对象通常指安全对象，可能是文件、文件夹、注册表项等。</p>
<p>3.当经过身份验证，Windows会为安全主题创建一个访问令牌，其中包含验证过程返回的SID和本地安全策略分配给用户的用户权限列表。</p>
<p>4.当安全对象被创建时，Windows会为其创建一个安全描述符，Windows的访问控制正式将安全主体的访问令牌中的信息于安全对象的安全描述中的访问控制项进行比较做出访问决策的。</p>
<h3 id="1-Windows访问控制模型"><a href="#1-Windows访问控制模型" class="headerlink" title="1.Windows访问控制模型"></a>1.Windows访问控制模型</h3><h4 id="1-1访问令牌"><a href="#1-1访问令牌" class="headerlink" title="1.1访问令牌"></a>1.1访问令牌</h4><p>用户登录时，Windows对用户身份进行验证，验证通过为用户创建一个访问令牌。该令牌包括登录过程返回的SID、由本地安全策略分配给用户和用户所属安全组的特权列表</p>
<p>访问令牌主要包含信息:<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302344914.png"></p>
<h4 id="1-2安全描述符"><a href="#1-2安全描述符" class="headerlink" title="1.2安全描述符"></a>1.2安全描述符</h4><p>1.安全描述符是一种与每个安全对象相关联的数据结构，其中包含与安全对象相关联的安全信息。<br>2.安全对象被创建时，操作系统会为其创建一个安全描述符。<br>3.安全描述符主要有SID和ACL组成。SID用来表示用户账户和该用户所属的组,ACL(访问控制列表)分为DACL和SACL两种。</p>
<h3 id="2-访问控制列表"><a href="#2-访问控制列表" class="headerlink" title="2.访问控制列表"></a>2.访问控制列表</h3><p>ACL是访问控制项(ACE)的列表, 每个访问控制项制定了一系列访问权限。</p>
<p>假设有安全主体A和安全对象B, 当A访问B,A会出示自己的访问令牌,其中包含自己的用户SID,所属用户组的SID和特权列表。<br>安全对象B有自己的访问控制列表,会先判断自己是不是需要特权才能访问,如果需要特权,就根据安全主体A的访问令牌查看自己是否具有该特权。然后安全对象B将安全主体A的访问令牌与自己的访问控制列表比对，并决定是否让A访问。</p>
<p>此过程中，访问控制列表主要的两个作用: 1.进行访问权限控制,判断安全主体能不能访问该安全对象。<br>2.日志记录功能,对用户访问行为的成功与否进行日志记录。</p>
<h4 id="2-1-DACL"><a href="#2-1-DACL" class="headerlink" title="2.1 DACL"></a>2.1 DACL</h4><p>1.DACL(自主访问控制列表)是安全对象的访问控制策略,其中定义了该安全对象的访问控制策略,用于指定允许或拒绝特定安全主体对该安全对象的访问。<br>2.DACL是由一条条的访问控制项ACE条目构成的,每条ACE定义了哪些用户或组队该对象拥有怎样的访问权限。每个ACE指定了一组访问权限，并包含一个SID。该SID标识了允许或拒绝访问该安全对象的安全主体。<br>3.如果安全对象没有配置DACL,则系统默认允许所有访问操作<br>如果配置了DACL没有配置ACE条目,系统默认拒绝所有访问操作<br>如果系统配置了DACL和ACE,那么系统将按顺序读取ACE,直到找到一个或多个允许或拒绝安全对象访问行为的ACE。<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308310923359.png"></p>
<h4 id="2-2-SACL"><a href="#2-2-SACL" class="headerlink" title="2.2 SACL"></a>2.2 SACL</h4><p>1.SACL(系统访问控制列表)是安全主体对安全对象的访问行为的审计策略,也是由一条条ACE条目构成。<br>2.每条ACE定义了对哪些安全主体的哪些访问行为进行日志记录。安全主体的访问行为满足这条ACE就会被记录。<br>可以把一条ACE归纳为4方面: 1.谁对这个安全对象拥有控制权限 2.拥有什么权限 3. 这个权限是允许还是拒绝 4. 这个权限能不能继承</p>
<h4 id="2-3-查看与修改访问控制列表"><a href="#2-3-查看与修改访问控制列表" class="headerlink" title="2.3 查看与修改访问控制列表"></a>2.3 查看与修改访问控制列表</h4><p>Icacls 是一种命令行工具,使用icacls命令可以查看或修改指定文件上的访问控制列表,并将存储的DACL应用于指定目录中的文件。</p>
<p>例如,执行以下命令:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">icacls C:\Users\Alice\Desktop\test.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308310927909.png"></p>
<p>权限说明:<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308310929931.png"><br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308310929523.png"></p>
<p>将指定目录及子目录下所有文件的ACLl备份到AcFile.txt</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">icacls C:\USers\Alice\Desktop\* /save AcFile.txt /T</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308310933307.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311324551.png"></p>
<p>执行以下命令将AcFile.txt内所有备份的文件ACL还原到指定目录及子目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">icacls C:\Users\Alice\Desktop\ /restore AcFile.txt</span><br></pre></td></tr></table></figure>

<p>给用户Hacker添加指定文件或目录的完全访问权限</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">icacls C:\Users\Alice\Desktop\Test /grant Hacker:(OI)(CI)(F) /t</span><br></pre></td></tr></table></figure>
<p>OI 代表对象集成 CI代表容器集成 F 代表完全访问</p>
<p>执行以下命令删除Hacker对指定文件或目录的完全访问权限</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">icaclas C:\Users\Alice\Desktop\Test /remove Hacker /t</span><br></pre></td></tr></table></figure>

<h2 id="6-组策略"><a href="#6-组策略" class="headerlink" title="6.组策略"></a>6.组策略</h2><p>组策略是Windows环境下管理账户的一种手段,可以控制用户账户和计算机账户的工作环境。组策略提供了操作系统、应用程序和活动目录中用户设置的集中化管理和配置。<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311814326.png"><br>1.本地组策略是组策略基本版本，适用于管理独立且非域环境的计算机<br>2.域环境中的组策略适用于管理域环境的所有对象，包括所有用户和计算机，可对域环境中的所有用户和计算机等对象进行多维管理，如安全配置、应用程序安装配置、开关机等</p>
<h4 id="6-1组策略对象"><a href="#6-1组策略对象" class="headerlink" title="6.1组策略对象"></a>6.1组策略对象</h4><p>组策略对象(GPR)是组策略设置的集合。<br>在设置组策略时，只要将组策略对象链接道指定站点、域和组织单位，其中的策略值便会应用到该站点、域和组织单位的所有用户和计算机。</p>
<p>组策略对象由组策略容器(GPC)和组策略模板(GPT)两个组件组成在Windows中分别存储在与孔的不同位置。<br>GPC存储与活动目录的域分区<br>GPT存放在与控制器的%SYSTEMROOT%\SYSVOL\sysvol\域名\Policies文件夹中</p>
<p>可以通过组策略管理来查看和编辑每个GPO的设置<br>可以看到两个默认组策略对象Default Domain Policy 和 Default Domain Controller Policy,他们在域控被创建时自动建立<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311821955.png"></p>
<p>(1)Default Domain Policy 默认组策略对象<br>Default Domain Policy 应用到其所在域的所有用户和计算机<br>右键该组策略可以保存报告,保存类型可以为HTML或XML.<br>右键选择编辑可以打开组策略编辑器<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311824303.png"></p>
<p>组策略编辑器可以分别对该组策略链接到的作用于的用户和计算机进行配置,分为策略和首选项两种不同强制程度。策略配置是强制性的配置，作用域中的客户端应用这些配置后就无法自行更改。首选项相当于默认值的作用是非强制的，客户端可以自行更改其中的配置值。</p>
<p>(2)Default Domain Controllers Policy 默认组策略对象<br>Default Domain Controllers Policy 应用道Domain Controllers 中所有的用户和计算机</p>
<h5 id="组策略容器"><a href="#组策略容器" class="headerlink" title="组策略容器"></a>组策略容器</h5><p>组策略容器存储在活动目录的与分区中，路径为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CN=Policies, CN=System, DC=hack-my, DC=com</span><br></pre></td></tr></table></figure>
<p>GPC中记录着该组策略对象的策略名称、标识组策略的GUID、组策略链接到的作用域、组策略模板的路径、组策略的版本信息等各种元数据。<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311834919.png"><br>displayName为组策略名称, 该组策略名为Default Domain Policy<br>gPCFileSysPath属性为组策略模板存放的路径,该组策略模板存放路径为\\hack-my.com\sysvol\hack-my.com\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}</p>
<p>当域中某对象应用某组策略时,该对象的gPLink属性值将指向这条组策略的完整DN<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311838884.png"><br>图中DC&#x3D;hack-my, DC&#x3D;com 应用了Default Domain Policy 组策略,所以该组织单位的gPLink属性值指向了Default Domain Policy 组策略的完整DN</p>
<h5 id="组策略模板"><a href="#组策略模板" class="headerlink" title="组策略模板"></a>组策略模板</h5><p>GPT存储该组策略实际的配置数据，被存放在域控制器的共享目录。%SYSTEMROOT%\SYSVOL\sysvol\域名\Policies下以GUID命名的文件夹中</p>
<p>以GUID标识的各组策略配置目录中包含以下内容<br>MACHINE: 该文件包含一些针对该组策略的整个作用域中计算机的具体配置。<br>USER: 该文件包含一些针对该组策略的整个作用域中用户的信息。<br>GPT.INI: 该文件包含一些关于该组策略的策略名称、版本信息等配置信息。</p>
<h4 id="6-2-组策略的创建"><a href="#6-2-组策略的创建" class="headerlink" title="6.2 组策略的创建"></a>6.2 组策略的创建</h4><p>创建一个新的组策略,并将其应用一个预先创建的组织单位”科研中心”.</p>
<p>右键 组策略对象<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311840165.png"></p>
<p>随便取名为Test Domain Policy<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311842040.png"></p>
<p>右键hack-my.com 创建组织单位命名为科研部门<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311843472.png"></p>
<p>右键科研部门,选择链接现有GPO,选择Test Domain Policy<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311844507.png"></p>
<p>此时Test Domain Policy已经被链接到了科研部门。<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311848550.png"><br>接着可以编辑这条组策略，例如将这条组策略中的用户密码长度最小长度为7<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308311849168.png"></p>
<h2 id="7-内网环境搭建"><a href="#7-内网环境搭建" class="headerlink" title="7.内网环境搭建"></a>7.内网环境搭建</h2><p>windows镜像下载地址: <a target="_blank" rel="noopener" href="https://msdn.itellyou.cn/">https://msdn.itellyou.cn/</a></p>
<h3 id="单域环境搭建"><a href="#单域环境搭建" class="headerlink" title="单域环境搭建"></a>单域环境搭建</h3><p>网络环境拓补<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308271255081.png"></p>
<h4 id="1-Windows-Server-2012-DC"><a href="#1-Windows-Server-2012-DC" class="headerlink" title="1.Windows Server 2012 -DC"></a>1.Windows Server 2012 -DC</h4><p>1.网络配置</p>
<p>IP: 192.168.89.10<br>子网掩码: 255.255.255.0<br>默认网关: 192.168.89.1<br>DNS指向本机IP: 192.168.89.10<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291633039.png"></p>
<p>2.主机属性设置<br>主机名: DC<br>域: hack-my.com<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308271305344.png"></p>
<p>服务器管理器-&gt;添加角色和功能<br>默认下一步,直到出现选择服务器角色的步骤,在角色中勾选DNS服务器和Active Directory域服务<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308271311038.png"></p>
<p>勾选如果需要,自动重启服务器<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308271435823.png"></p>
<p>这里我选择安装后把虚拟机重启了<br>需要指定升级为域控<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291420382.png"><br>写入域名hack-my.com<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291422934.png"></p>
<p>设定DSRM(目录服务还原模式,允许管理员在域环境出故障时还原目录数据库)密码<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291424520.png"></p>
<p>之后保持默认下一步<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291429215.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291430888.png"></p>
<p>发现需要重置Administrator的密码<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291433261.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291435266.png"><br>再次检查先决条件,安装即可<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291436956.png"></p>
<p>安装成功后,重新启动服务器,切换至Administrator登录<br>发现AD DS 和 DNS 安装成功<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291549738.png"></p>
<p>把DNS改回 192.168.89.10</p>
<p>为了能让后续加入域中的Windows Server 2008 和 Windows 7 用户可以正常登录,为他们创建域用户<br>打开服务器管理器-&gt;工具-&gt;Active Directory 用户和计算机, 选中Users目录并单击右键<br>新建用户Alice,并设置其密码永不过期<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291559165.png"><br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291601871.png"></p>
<p>Alice - ==xy159753<br>成功创建用户Alice<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291604100.png"></p>
<h4 id="2-Windows-Server-2008-Web"><a href="#2-Windows-Server-2008-Web" class="headerlink" title="2.Windows Server 2008 - Web"></a>2.Windows Server 2008 - Web</h4><p>先改网络设置<br>ip: 192.168.89.20<br>子网掩码: 255.255.255.0<br>默认网关:192.168.89.1<br>DNS: 192.168.89.10<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291631784.png"></p>
<p>将该主机添加值域中<br>控制面板-&gt;系统-&gt;改变设置<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291638603.png"></p>
<p>登录域用户<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291640421.png"></p>
<p>成功加入域<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291641456.png"></p>
<h4 id="3-Windows-7"><a href="#3-Windows-7" class="headerlink" title="3.Windows 7"></a>3.Windows 7</h4><p>参照Windows Server 2008 加入域环境<br>IP: 192.168.89.30<br>子网掩码: 255.255.255.0<br>网关: 192.168.89.1</p>
<p>DNS: 192.168.89.10<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302044079.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302045994.png"></p>
<p>登录后,成功加入hack-my.com域<br><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302047083.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://Xrect1fy.github.io">Xrect1fy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://xrect1fy.github.io/2023/08/30/%E5%9F%9F%E6%B8%97%E9%80%8F(%E4%B8%80)-%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">http://xrect1fy.github.io/2023/08/30/%E5%9F%9F%E6%B8%97%E9%80%8F(%E4%B8%80)-%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://Xrect1fy.github.io" target="_blank">Xrect1fy's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308302059595.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/09/02/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/" title="数据库基础"><img class="cover" src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202309020112385.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">数据库基础</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/29/Typora%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%A4%8D%E7%8E%B0/" title="Typora 远程代码执行漏洞复现"><img class="cover" src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202308291359656.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Typora 远程代码执行漏洞复现</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/09/06/%E5%9F%9F%E6%B8%97%E9%80%8F(%E4%B8%89)-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E4%B8%8E%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/" title="域渗透(三)-端口转发与内网代理"><img class="cover" src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202309062216290.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-06</div><div class="title">域渗透(三)-端口转发与内网代理</div></div></a></div><div><a href="/2023/09/07/%E5%9F%9F%E6%B8%97%E9%80%8F(%E5%9B%9B)-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" title="域渗透(四)-权限提升"><img class="cover" src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202309062215759.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-07</div><div class="title">域渗透(四)-权限提升</div></div></a></div><div><a href="/2023/09/03/%E5%9F%9F%E6%B8%97%E9%80%8F(%E4%BA%8C)-%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" title="域渗透(二)-内网信息收集"><img class="cover" src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202309031411161.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-03</div><div class="title">域渗透(二)-内网信息收集</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/tx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Xrect1fy</div><div class="author-info__description">Welcome to Xrect1fy's blog!<br />🐱</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Xrect1fy/"><i class="fab fa-github || yellow"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=1696132196&amp;website=www.xrect1fy.com" target="_blank" title="QQ"><i class="fab fa-qq" style="color: #24292e;"></i></a><a class="social-icon" href="https://github.com/Xrect1fy" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:x1696132196@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #24292e;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">内网基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95-AD"><span class="toc-text">1.活动目录(AD)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1Ntds-dit%E6%96%87%E4%BB%B6"><span class="toc-text">1.1Ntds.dit文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E7%9B%AE%E5%BD%95%E6%9C%8D%E5%8A%A1%E4%B8%8ELDAP"><span class="toc-text">1.2目录服务与LDAP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.3活动目录的查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%9F%E7%94%A8%E6%88%B7%E4%B8%8E%E6%9C%BA%E5%99%A8%E7%94%A8%E6%88%B7%E4%BB%8B%E7%BB%8D"><span class="toc-text">2.域用户与机器用户介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E5%9F%9F%E7%94%A8%E6%88%B7"><span class="toc-text">2.1域用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E6%9C%BA%E5%99%A8%E7%94%A8%E6%88%B7"><span class="toc-text">2.2机器用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%9F%9F%E7%94%A8%E6%88%B7%E7%BB%84%E7%9A%84%E5%88%86%E7%B1%BB%E5%92%8C%E6%9D%83%E9%99%90"><span class="toc-text">3.域用户组的分类和权限</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%BB%84%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-text">安全组的权限</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%9F%E6%9C%AC%E5%9C%B0%E7%BB%84"><span class="toc-text">1.域本地组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%80%9A%E7%94%A8%E7%BB%84"><span class="toc-text">2.通用组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%85%A8%E5%B1%80%E7%BB%84"><span class="toc-text">3.全局组</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BB%84%E7%BB%87%E5%8D%95%E4%BD%8D"><span class="toc-text">4.组织单位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-text">5.访问控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Windows%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%9E%8B"><span class="toc-text">1.Windows访问控制模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C"><span class="toc-text">1.1访问令牌</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E5%AE%89%E5%85%A8%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-text">1.2安全描述符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8"><span class="toc-text">2.访问控制列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-DACL"><span class="toc-text">2.1 DACL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-SACL"><span class="toc-text">2.2 SACL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E6%9F%A5%E7%9C%8B%E4%B8%8E%E4%BF%AE%E6%94%B9%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8"><span class="toc-text">2.3 查看与修改访问控制列表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%BB%84%E7%AD%96%E7%95%A5"><span class="toc-text">6.组策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%E7%BB%84%E7%AD%96%E7%95%A5%E5%AF%B9%E8%B1%A1"><span class="toc-text">6.1组策略对象</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%B9%E5%99%A8"><span class="toc-text">组策略容器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%84%E7%AD%96%E7%95%A5%E6%A8%A1%E6%9D%BF"><span class="toc-text">组策略模板</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E7%BB%84%E7%AD%96%E7%95%A5%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-text">6.2 组策略的创建</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%86%85%E7%BD%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">7.内网环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%9F%9F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">单域环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Windows-Server-2012-DC"><span class="toc-text">1.Windows Server 2012 -DC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Windows-Server-2008-Web"><span class="toc-text">2.Windows Server 2008 - Web</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Windows-7"><span class="toc-text">3.Windows 7</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/04/27/URL%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%8E%BB%E9%87%8D%E5%A4%8D%E7%8E%B0/" title="URL相似度去重复现"><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202404271415252.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="URL相似度去重复现"/></a><div class="content"><a class="title" href="/2024/04/27/URL%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%8E%BB%E9%87%8D%E5%A4%8D%E7%8E%B0/" title="URL相似度去重复现">URL相似度去重复现</a><time datetime="2024-04-27T06:09:34.000Z" title="发表于 2024-04-27 14:09:34">2024-04-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/18/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0(%E6%8C%81%E7%BB%AD%E5%AD%A6%E4%B9%A0%E6%9B%B4%E6%96%B0)/" title="机器学习(持续学习更新)"><img src="https://cdn.jsdelivr.net/gh/0Rec1us/picorep//img/wallhaven-1pmoy3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="机器学习(持续学习更新)"/></a><div class="content"><a class="title" href="/2024/04/18/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0(%E6%8C%81%E7%BB%AD%E5%AD%A6%E4%B9%A0%E6%9B%B4%E6%96%B0)/" title="机器学习(持续学习更新)">机器学习(持续学习更新)</a><time datetime="2024-04-18T03:36:22.000Z" title="发表于 2024-04-18 11:36:22">2024-04-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/17/Pwn%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)-%E6%A0%88%E6%BA%A2%E5%87%BA(%E6%8C%81%E7%BB%AD%E5%AD%A6%E4%B9%A0%E6%9B%B4%E6%96%B0)/" title="Pwn学习笔记(二)-栈溢出(持续学习更新)"><img src="https://cdn.jsdelivr.net/gh/0Rec1us/picorep//img/wallhaven-m3m57k.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Pwn学习笔记(二)-栈溢出(持续学习更新)"/></a><div class="content"><a class="title" href="/2024/04/17/Pwn%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)-%E6%A0%88%E6%BA%A2%E5%87%BA(%E6%8C%81%E7%BB%AD%E5%AD%A6%E4%B9%A0%E6%9B%B4%E6%96%B0)/" title="Pwn学习笔记(二)-栈溢出(持续学习更新)">Pwn学习笔记(二)-栈溢出(持续学习更新)</a><time datetime="2024-04-17T02:41:44.000Z" title="发表于 2024-04-17 10:41:44">2024-04-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/16/Pwn%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%80)-gdb%E8%B0%83%E8%AF%95/" title="Pwn学习笔记(一)-gdb调试"><img src="https://cdn.jsdelivr.net/gh/0Rec1us/picorep//img/wallhaven-m3mmq9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Pwn学习笔记(一)-gdb调试"/></a><div class="content"><a class="title" href="/2024/04/16/Pwn%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%80)-gdb%E8%B0%83%E8%AF%95/" title="Pwn学习笔记(一)-gdb调试">Pwn学习笔记(一)-gdb调试</a><time datetime="2024-04-16T03:22:15.000Z" title="发表于 2024-04-16 11:22:15">2024-04-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/22/yolov5%E5%85%A5%E9%97%A8/" title="yolov5入门"><img src="https://cdn.jsdelivr.net/gh/Xrect1fy/picorep//img/202403221834840.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="yolov5入门"/></a><div class="content"><a class="title" href="/2024/03/22/yolov5%E5%85%A5%E9%97%A8/" title="yolov5入门">yolov5入门</a><time datetime="2024-03-22T10:29:05.000Z" title="发表于 2024-03-22 18:29:05">2024-03-22</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Xrect1fy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script src="http://cdn.bootcss.com/pace/1.0.2/pace.min.js" async></script><div class="aplayer no-destroy" data-id="8663354741" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true" data-lrcType="-1"> </div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>